
### Classifications showing Chemicals

While the table above shows chemicals with their classifications, it may be easier to understand when the data is grouped by classification instead of individual chemicals. Some chemicals may appear in more than one category.  The list below shows the classifications and chemicals found on your wristband.

<!-- 
[standard deviation](## "Standard deviation is blah blah.") 
-->


```{r  ListClassFound, results='asis', echo=FALSE, message=FALSE}

oneResultInvertClassified<- as.data.frame(
  inner_join(oneResult_with_Y_flag,class_L,by="ParameterID") %>% 
    select(classification,ParameterName) %>%
    group_by(classification) %>%
    dplyr::summarise(ParameterNames=paste(ParameterName,collapse=", ")) %>%
    ungroup %>%
    mutate_if(is.factor, as.character) %>%  #Eliminate classification as a FACTOR so it sorts correctly
    arrange(classification))

names(oneResultInvertClassified)<-c("Classification", "Chemical Name(s)" )



classExplainTable <- read.table(class_explain_table_name,  sep = ",",  header = TRUE   )

### NOTE INFO:---  Making this tooltip was TRICKY... if we want to change it just get rid of it... not worth the time
### NOTE INFO:---  Making this tooltip was TRICKY... if we want to change it just get rid of it... not worth the time


# Create tooltips for each word
create_tooltip <- function(classIf) {
  class_row <- classExplainTable %>% filter(Classification == classIf)
  if (nrow(class_row) == 0) {
    return(classIf)
  }

  description <- tags$span(title = class_row$Description, "---->Description")
  sources <- tags$span(title = class_row$Sources, "---->Sources")
  examples <- tags$span(title = class_row$Examples, "---->Examples")
  strategies <- tags$span(title = class_row$Strategies, "---->Strategies")

  return(paste0(classIf, '<br>', description, '<br>', sources, '<br>', examples, '<br>', strategies))
}

# Apply the function to create tooltips
oneResultInvertClassified$Classification <- sapply(oneResultInvertClassified$Classification, create_tooltip)

#Print the table with tooltips
pandoc.table(oneResultInvertClassified,
             caption = "Classification Report on your Wristband",
             justify = c("left", "center"),
             split.table = Inf,
             emphasis.rownames = TRUE)

# knitr::kable(oneResultInvertClassified, format = "html", escape = FALSE) %>%
#  kable_styling(full_width = F)


```

### Classifications vs Averages

When we break down the data by chemical classification (keeping in mind that some chemicals appear in more than one category), the results are as follows. The first column shows your wristband results, and the second column shows the average for all wristbands in this project.

`r if(nrow(testResults.big[testResults.big[, "Flag"] == "Y", ])>0){"Any wristbands where we detected a chemical, but could not quantify it, are suppressed from this chart below"}`

```{r CompareWhatClassificationsFound , results='asis', echo=FALSE, message=FALSE }

#knitr::kable(ClassCompare[,2:ncol(ClassCompare)],format="markdown")
#FIRST change column names so Partcipant becomes the actual name of the subject
# names(ClassCompareSubject)<-c("Classification",subject,"Average","maxFoundAnyOneBand")
# ClassCompareSubject<-ClassCompareSubject %>%
#     mutate_if(is.factor, as.character) %>%   #Eliminate classification as a FACTOR so it sorts correctly
#     ClassCompareSubject(Classification) 

ClassCompareSubject2 <- ClassCompareSubject %>%
    select(classification,Participant,Average) %>%
    dplyr::rename(You=Participant)


pandoc.table(ClassCompareSubject2,
              justify=c("left","center","center")
              ,split.table = Inf)

rm(ClassCompareSubject2)

```

<br>
<br>

