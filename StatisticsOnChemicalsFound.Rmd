


```{r setupbs_modal_std_dev, echo=FALSE}
library("htmltools")
#install.packages("bsplus")
library("bsplus")

```








## Statistics on Chemicals Found




```{r setupbs_modal_std_dev3, echo=FALSE}


bs_modal(id = "StandardDeviation3", title = "Definition of Standard Deviation", body = "Standard deviation is a measure of how spread out all the results are from the average. A bigger standard deviation means the numbers are more spread out, while a smaller one means they're closer to the average.")

#MAYBE add MEAN and MEDIAN definitions sometime
#bs_modal(id = "Mean3", title = "Definition of MEAN", body = "The mean, or average, is the total of all the numbers divided by how many numbers there are. It’s a way to find the 'typical' value of a set of numbers.")

#bs_modal(id = "Median3", title = "Definition of MEDIAN", body = "The median is the middle value in a list of numbers sorted from smallest to largest. It’s the one right in the middle. It shows the 'center' of the data without being affected by very high or very low numbers.")


  
```



One important way to look at the data is, for each chemical, what was the smallest, largest, average, and middle value found, how many wristbands was it found on, and the `r bs_button("standard deviation", button_type = "primary", class = "btn-xs btn-outline-info") %>% bs_attach_modal(id_modal = "StandardDeviation3")`. The wristbands were tested for different chemicals. The results show how much of each chemical was found, adjusted for the time worn.  Anything we couldn't clearly detect was left out of the table below.  The table lists all the chemicals found in your wristband.  Your chemicals are in the first column. The remaining columns describe mathmatical characteristics of these chemicals across the entire group of people.


<!--
One important way to look at the data is, for each chemical, what was the smallest, largest, average, and middle value found, how many wristbands was it found on, and the standard deviation.  The wristbands were tested for different chemicals. The results show how much of each chemical was found, adjusted for the time worn.  Anything we couldn't clearly detect was left out of the table below.
-->

```{r print_not_time_or_weight_adjust, results="asis", echo=FALSE, eval=!(wristbands_weight_adjusted || wristbands_time_adjusted)}
cat("The data is the raw nanograms found in each wristband. ", sep = "")
```

```{r print_weight_only_adjust1, results="asis", echo=FALSE, eval=wristbands_weight_adjusted}
cat("The data is the raw nanograms found in each gram of wristband. ", sep = "")
```

```{r print_loreal_4x, results="asis", echo=FALSE, eval=wristbands_time_adjusted_one_week_not_weight}
cat("The data is the raw nanograms found normalized to time-adjust the values as though the wristband were worn for exactly one week. ", sep = "")
```

```{r print_loreal_4x3, results="asis", echo=FALSE, eval=wristbands_week_and_weight_adjusted}
cat("The data shows the amount of each chemical in nanograms per gram of wristband, adjusted for the time worn to make results comparable.",
  sep = ""
)
```

```{r print_loreal_4x2, results="asis", echo=FALSE, eval=(wristbands_time_adjusted_one_day & FALSE) }
# NOTE:  I think i suppressed this message from ever showing BECAUSE i don't think it is necessary and adds complications to understanding

cat("The data is the raw nanograms found normalized to time-adjust the values as though the wristband were worn for exactly one day. ")
```

<!-- Values below the limit of detection are not included in the statistical analyses and are listed as zeros. -->

```{r StatSummary, results='asis', echo=FALSE, eval=TRUE, message=FALSE}
### Had error where i was renaming columns for 2nd time so it didn't work.
### Need to test if column names wrong and rename only if wrong:
if ("Chemical_Name" %in% colnames(statSummary)) {
  statSummary <- statSummary %>% dplyr::rename("Chemical Name" = Chemical_Name, 
                                               "Standard Deviation" = Standard_Deviation,
                                               "Smallest Value Found" = MinResult ,
                                               "Largest Value Found" = MaxResult,
                                               "Average Value Found" = MeanResult,
                                               "Middle Value Found" = MedianResult,
                                               "How Many Wristbands Had this" = Count)
}


if (HideIndividualization) {
  panderOptions("big.mark", ",") # THIS line ADDS a COMMA in MOST of the numbers (not all... )

  pandoc.table(as.data.frame(statSummary),
    caption = "Statistical Report on all Chemicals on all Wristbands",
    justify = c("right", "right", "right", "right", "right", "right", "right"),
    emphasis.rownames = TRUE,
    split.table = Inf
  )
} else {
  #
  oneResultStatSummary <- oneResult %>%
    select(ParameterName, Result) %>%
    rename("Chemical Name" = ParameterName) %>%
    #right_join(statSummary, by = "Chemical Name") %>% ## THIS RIGHT JOIN makes it for EVERY chemical found anywhere...
    left_join(statSummary, by = "Chemical Name") %>% ## THIS left JOIN makes it for ONLY chemical found on this wristband
    replace_na(list(Result = 0)) %>%
    rename(!!paste(pureSubjectName, "Result", sep = " ") := Result)

  panderOptions("big.mark", ",") # THIS line ADDS a COMMA in MOST of the numbers (not all... )

  pandoc.table(as.data.frame(oneResultStatSummary),
    caption = paste("Statistical Report on all Chemicals on ", pureSubjectName, " wristband", sep = " "),
    justify = c("right", "right", "right", "right", "right", "right", "right", "right"),
    emphasis.rownames = TRUE,
    split.table = Inf
  )
  
#   # Convert data to long format for heatmap plotting
# heatmap_data <- oneResultStatSummary %>%
#   pivot_longer(cols = c(`Smallest Value Found`, `Largest Value Found`, `Average Value Found`,
#                         `Middle Value Found`, `Standard Deviation`),
#                names_to = "Statistic", values_to = "Value") %>%
#   filter(`Chemical Name` %in% top_chemicals$`Chemical Name`)
# 
# # # Plot heatmap
# ggplot(heatmap_data, aes(x = Statistic, y = `Chemical Name`, fill = Value)) +
#   geom_tile() +
#   scale_fill_gradient(low = "white", high = "darkred") +
#   labs(title = "Heatmap of Chemical Statistics",
#        x = "Statistic",
#        y = "Chemical Name") +
#   theme_minimal()

  
  
  
  
  
  
}



if (FALSE) { # THIS IS THE BIG DATA

  panderOptions("big.mark", ",") # THIS line ADDS a COMMA in MOST of the numbers (not all... )

  pandoc.table(as.data.frame(bigStatSummary),
    caption = "Statistical Report on all Chemicals on all Wristbands found  in Large Demo Set compared to this smaller data set",
    justify = "right",
    emphasis.rownames = TRUE,
    split.table = Inf
  )
}


if (OutputBigComparisonStatTable) {
  panderOptions("big.mark", ",") # THIS line ADDS a COMMA in MOST of the numbers (not all... )

  pandoc.table(as.data.frame(bigStatSummaryJustTheseChemicals),
    caption = "Statistical Report on all Chemicals on This Groups Wristbands compared to values for these chemicals in Larger Demo  data set",
    justify = "right",
    emphasis.rownames = TRUE,
    split.table = Inf
  )
}





# =======
###
### THIS STUFF BELOW is the area that had some kinda conflict not sure what happened in GIT so i comment this out and leave stuff ABOVE for NOW
###
### IF I WANTED TO DO statSummaryand include e ONE user's chemical results in a list showing all chemicals found
# Then:  make the oneResultStatSummary and other pandoc table below...
#  oneResultStatSummary<- oneResult %>%
#    select(ParameterName,Result) %>%
#    rename(!!paste(subject,"Result",sep=" "):= Result) %>%
#    rename("Chemical Name"=ParameterName) %>%
#    right_join(statSummary,by="Chemical Name")
#
#  panderOptions("big.mark", ",") # THIS line ADDS a COMMA in MOST of the numbers (not all... )
#
#  pandoc.table(as.data.frame(oneResultStatSummary)
#               ,caption=paste("Statistical Report on all Chemicals on just",subject,"wristband",sep=" ")
#               ,justify=c("right","right","right","right","right","right","right","right")
#               ,emphasis.rownames=TRUE
#               ,split.table = Inf
#               )
# }
#>>>>>>> 88bf3a8b0c245ea66eeb8eddcecef7284980b12c
```

<br> <br>
